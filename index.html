<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Sahib Virdee</title>
    <meta name="description" content="Portfolio of Sahib Virdee, Mechanical Engineering student.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    
    <style>
        /* --- DESIGN SYSTEM --- */
        :root {
            --bg: #050505;
            --card-bg-hover: #111;
            --text-main: #d4d4d4;
            --text-dim: #999;
            
            --accent-personal: #4dff88;
            --accent-prof: #00ffff;
            --accent-projects: #ff9933;
            
            --header-bg: rgba(5,5,5,0.98);
            --ease: cubic-bezier(0.25, 1, 0.5, 1);
            
            /* Header Dimensions */
            --h-top-height: 40px;
            --h-main-height: 30px; 
            --h-sub-height: 28px;
            --h-tert-height: 28px;
            --header-total: calc(var(--h-top-height) + var(--h-main-height) + var(--h-sub-height) + var(--h-tert-height) + 10px);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html { 
            scroll-behavior: smooth; 
            overflow-x: hidden; 
            width: 100%;
        }

        body {
            background-color: var(--bg); color: var(--text-main); font-family: 'Jost', sans-serif; line-height: 1.5;
            padding-top: var(--header-total); 
            display: flex; flex-direction: column; min-height: 100vh;
            width: 100%; position: relative; overflow-x: hidden; 
        }

        /* --- GLOBAL ANIMATION --- */
        .fill-anim {
            background: linear-gradient(to top, var(--text-hover, #fff) 50%, var(--text-base, #888) 50.5%);
            background-size: 100% 205%;
            background-position: 0 0; 
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
            transition: background-position 0.5s var(--ease);
            text-decoration: none; display: inline-block; color: var(--text-base, #888); 
        }

        .fill-anim:hover, .clickable-block:hover .fill-anim, .fill-anim.active {
            background-position: 0 100%; color: var(--text-hover, #fff);
        }

        h1.fill-anim, h2.fill-anim { --text-base: #fff; --text-hover: #999; }

        /* --- HEADER ARCHITECTURE --- */
        #main-header {
            position: fixed; top: 0; left: 0; width: 100%; 
            background: var(--header-bg); z-index: 1000; 
            display: flex; flex-direction: column; 
            border-bottom: 1px solid #1a1a1a;
            transition: transform 0.4s var(--ease);
        }

        /* Header Rows */
        .header-row {
            width: 100%; display: flex; align-items: center; justify-content: center;
            transition: height 0.4s var(--ease), opacity 0.4s var(--ease), margin 0.4s var(--ease);
            position: relative;
        }

        /* Row 1: Brand & Search */
        #h-top {
            height: var(--h-top-height);
            justify-content: space-between; /* Spread brand and search */
            padding: 0 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        #brand-name {
            font-size: 18px; font-weight: 700; text-transform: uppercase; letter-spacing: 3px; cursor: pointer;
            --text-base: #666; --text-hover: #fff;
        }

        /* Row 2: Main Nav (Static) */
        #h-main {
            height: var(--h-main-height);
            margin-top: 4px; /* Tight spacing */
        }

        #primary-nav { 
            display: flex; gap: 30px; 
        }

        .nav-link {
            font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
            user-select: none; --text-base: #666; --text-hover: #fff; cursor: pointer;
        }
        
        /* Specific Colors */
        .nav-link[data-cat="Projects"] { --text-hover: var(--accent-projects); }
        .nav-link[data-cat="Projects"].active { --text-base: var(--accent-projects); }
        .nav-link[data-cat="Professional"] { --text-hover: var(--accent-prof); }
        .nav-link[data-cat="Professional"].active { --text-base: var(--accent-prof); }
        .nav-link[data-cat="Personal"] { --text-hover: var(--accent-personal); }
        .nav-link[data-cat="Personal"].active { --text-base: var(--accent-personal); }

        /* Row 3 & 4: Sub & Tertiary (Dynamic) */
        .scrolling-nav {
            overflow-x: auto; white-space: nowrap; 
            display: flex; gap: 20px; justify-content: center;
            scrollbar-width: none;
            mask-image: linear-gradient(to right, transparent 0, black 40px, black calc(100% - 40px), transparent 100%);
            -webkit-mask-image: linear-gradient(to right, transparent 0, black 40px, black calc(100% - 40px), transparent 100%);
            width: 100%; max-width: 900px;
        }
        .scrolling-nav::-webkit-scrollbar { display: none; }

        #h-sub { height: 0; opacity: 0; transition: all 0.4s var(--ease); overflow: hidden; }
        #h-sub.visible { height: var(--h-sub-height); opacity: 1; margin-top: 2px; }
        
        #h-tert { height: 0; opacity: 0; transition: all 0.4s var(--ease); overflow: hidden; margin-bottom: 0; }
        #h-tert.visible { height: var(--h-tert-height); opacity: 1; margin-top: 2px; margin-bottom: 6px; } /* Small bottom gap */

        .sub-link, .tert-link {
            font-size: 14px; /* Increased Typography */
            font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;
            --text-base: #555; --text-hover: #ddd; cursor: pointer;
        }
        .sub-link.active, .tert-link.active { --text-base: #fff; }

        /* COLLAPSE LOGIC */
        body.header-collapsed #main-header {
            transform: translateY(calc(var(--h-top-height) * -1));
        }

        /* --- SEARCH --- */
        #search-trigger-container {
            width: 24px; height: 24px; position: relative; cursor: pointer;
        }
        .icon-btn { position: absolute; top:0; left:0; width: 100%; height: 100%; fill: #666; transition: all 0.3s; }
        .icon-btn:hover { fill: #fff; }
        
        /* 100% Opaque Search Overlay */
        #search-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--h-top-height);
            background-color: #000; z-index: 1005;
            display: flex; align-items: center; justify-content: center;
            transform: translateY(-100%); transition: transform 0.3s var(--ease);
        }
        #search-overlay.active { transform: translateY(0); }
        
        #search-input {
            width: 100%; max-width: 600px; background: transparent; border: none; 
            color: #fff; font-size: 16px; font-family: 'Jost', sans-serif; 
            text-align: center; outline: none; text-transform: uppercase; letter-spacing: 2px;
        }

        #close-search { position: absolute; right: 20px; width: 20px; height: 20px; cursor: pointer; fill: #666; }
        #close-search:hover { fill: #fff; }

        /* --- LAYOUT --- */
        .content-container { max-width: 1000px; width: 100%; margin: 0 auto; padding: 20px 20px 0; min-height: 80vh; }
        .section { margin-bottom: 15px; opacity: 0; animation: fadeIn 0.4s forwards; } 
        @keyframes fadeIn { to { opacity: 1; } }

        /* --- GRID CARDS --- */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px 20px; }
        .layout-grid { display: flex; flex-direction: column; gap: 3px; padding: 12px; border-radius: 6px; transition: background 0.2s; cursor: pointer; position: relative; }
        .layout-grid:hover { background: var(--card-bg-hover); }

        .row-media { width: 100%; height: 160px; border-radius: 4px; overflow: hidden; background: #111; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; }
        .row-media img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%); transition: filter 0.3s; }
        .layout-grid:hover .row-media img { filter: grayscale(0%); }
        
        .row-media.placeholder span { font-size: 14px; font-weight: 700; text-transform: uppercase; color: #444; letter-spacing: 1px; }
        .layout-grid.cat-projects:hover .row-media.placeholder span { color: var(--accent-projects); }
        .layout-grid.cat-professional:hover .row-media.placeholder span { color: var(--accent-prof); }
        .layout-grid.cat-personal:hover .row-media.placeholder span { color: var(--accent-personal); }

        .layout-grid h3 { font-size: 18px; font-weight: 500; margin: 0; color: #eee; }
        .layout-grid p { font-size: 14px; margin: 0; color: var(--text-dim); }
        
        .meta-row { display: flex; gap: 6px; margin-top: auto; padding-top: 8px; flex-wrap: wrap; }
        .chip { font-size: 11px; font-weight: 600; color: #777; background: #1a1a1a; padding: 3px 8px; border-radius: 4px; text-transform: uppercase; transition: 0.2s; }
        .chip:hover { color: #fff; background: #333; }
        .chip.date { background: transparent; border: 1px solid #333; color: #666; }

        /* --- TIMELINE VIEW --- */
        .timeline-container { padding: 20px 0; }
        .timeline-group { display: flex; margin-bottom: 40px; }
        
        .timeline-date { 
            width: 120px; flex-shrink: 0; padding-top: 20px; 
            font-size: 14px; font-weight: 700; color: #555; text-transform: uppercase; letter-spacing: 1px;
            text-align: right; padding-right: 20px; border-right: 1px solid #1a1a1a;
        }
        
        .timeline-cards { 
            flex-grow: 1; display: flex; gap: 20px; overflow-x: auto; 
            padding: 10px 20px; scrollbar-width: none; position: relative;
            mask-image: linear-gradient(to right, black 90%, transparent 100%);
            -webkit-mask-image: linear-gradient(to right, black 90%, transparent 100%);
        }
        .timeline-cards::-webkit-scrollbar { display: none; }
        
        .timeline-cards .layout-grid { 
            width: 260px; flex-shrink: 0; background: #0a0a0a; border: 1px solid #1a1a1a;
        }
        .timeline-cards .layout-grid:hover { border-color: #333; }

        @media (max-width: 768px) {
            .timeline-group { flex-direction: column; }
            .timeline-date { width: 100%; text-align: left; padding: 0 0 10px 20px; border-right: none; border-bottom: 1px solid #1a1a1a; margin-bottom: 10px; }
            .timeline-cards { mask-image: linear-gradient(to right, black 85%, transparent 100%); }
        }

        /* --- INDEX VIEW --- */
        .index-list { column-count: 2; column-gap: 40px; margin-top: 20px; }
        .index-group { break-inside: avoid; margin-bottom: 30px; }
        .index-group h3 { font-size: 14px; text-transform: uppercase; color: #666; border-bottom: 1px solid #222; padding-bottom: 5px; margin-bottom: 10px; }
        
        .index-link { display: block; font-size: 16px; margin-bottom: 6px; text-decoration: none; position: relative; padding-left: 0; transition: padding 0.2s; }
        .index-link.level-2 { padding-left: 20px; font-size: 15px; color: #888; }
        .index-link.level-2::before { content: "L"; position: absolute; left: 5px; top: 0; opacity: 0.3; transform: scaleY(-1) rotate(-45deg); font-size: 12px; }
        
        .index-group.cat-projects h3 { color: var(--accent-projects); border-color: var(--accent-projects); }
        .index-group.cat-professional h3 { color: var(--accent-prof); border-color: var(--accent-prof); }
        .index-group.cat-personal h3 { color: var(--accent-personal); border-color: var(--accent-personal); }

        /* --- FOOTER --- */
        footer { 
            text-align: center; padding: 40px 20px; border-top: 1px solid #1a1a1a; margin-top: auto;
            display: flex; flex-direction: column; gap: 15px; align-items: center;
        }
        .footer-links { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        .footer-links a { font-size: 13px; color: #666; text-decoration: none; transition: 0.2s; }
        .footer-links a:hover { color: #fff; }

        /* --- UTILS --- */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="search-overlay">
        <input type="text" id="search-input" placeholder="SEARCH..." onkeyup="handleSearch(this.value)">
        <svg id="close-search" onclick="toggleSearch(false)" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
    </div>

    <header id="main-header">
        <div id="h-top" class="header-row">
            <div id="brand-name" class="fill-anim" onclick="route('Home')">SAHIB VIRDEE</div>
            <div id="search-trigger-container" onclick="toggleSearch(true)">
                <svg class="icon-btn" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            </div>
        </div>

        <div id="h-main" class="header-row">
            <nav id="primary-nav"></nav>
        </div>

        <div id="h-sub" class="header-row">
            <nav id="sub-nav-container" class="scrolling-nav"></nav>
        </div>

        <div id="h-tert" class="header-row">
            <nav id="tert-nav-container" class="scrolling-nav"></nav>
        </div>
    </header>

    <div class="content-container" id="app"></div>

    <footer>
        <div class="footer-links" id="footer-links"></div>
        <div id="version-tag" style="font-size:12px; color:#444;"></div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script>
        let db = [];
        const CONFIG = {
            sheet: "https://docs.google.com/spreadsheets/d/e/2PACX-1vT7HtdJsNwYO8TkB4mem_IKZ-D8xNZ9DTAi-jgxpDM2HScpp9Tlz5DGFuBPd9TuMRwP16vUd-5h47Yz/pub?gid=0&single=true&output=csv"
        };

        const init = () => {
            Papa.parse(CONFIG.sheet, {
                download: true, header: true, skipEmptyLines: true,
                complete: (r) => {
                    db = r.data.filter(row => row.Title); // basic validation
                    setupInteractions();
                    handleRouting();
                    renderFooter();
                }
            });
        };

        /* --- NAVIGATION LOGIC --- */
        function route(path) {
            window.location.hash = path;
        }

        function handleRouting() {
            window.scrollTo(0,0);
            toggleSearch(false);
            
            let hash = window.location.hash.substring(1) || 'Home';
            
            // Clean hash for logic
            const parts = hash.split('/');
            const topLevel = parts[0];
            const subLevel = parts.length > 1 ? parts[1] : null;
            const tertLevel = parts.length > 2 ? parts[2] : null;

            buildNavs(topLevel, subLevel, tertLevel);

            if (hash === 'Index') renderIndex();
            else if (hash === 'Timeline') renderTimeline();
            else if (hash === 'Home') renderHome();
            else renderPage(hash, topLevel);
        }

        function buildNavs(activeTop, activeSub, activeTert) {
            // 1. Primary Nav
            const nav = document.getElementById('primary-nav');
            // Hardcode or Dynamic? Dynamic is better.
            const tops = ['Projects', 'Professional', 'Personal'];
            nav.innerHTML = tops.map(t => 
                `<div class="nav-link fill-anim ${t === activeTop ? 'active' : ''}" 
                 data-cat="${t}" onclick="route('${t}')">${t}</div>`
            ).join('');

            // 2. Sub Nav (Children of activeTop)
            const subContainer = document.getElementById('h-sub');
            const subNav = document.getElementById('sub-nav-container');
            
            // Find all pages starting with activeTop/
            // Extract the second part.
            const validSubs = [...new Set(db
                .filter(r => r.Page && r.Page.startsWith(activeTop + '/'))
                .map(r => r.Page.split('/')[1])
                .filter(x => x)
            )].sort();

            if (validSubs.length > 0 && activeTop !== 'Home' && activeTop !== 'Timeline' && activeTop !== 'Index') {
                subContainer.classList.add('visible');
                subNav.innerHTML = validSubs.map(s => {
                    const isActive = (s === activeSub);
                    const path = `${activeTop}/${s}`;
                    return `<div class="sub-link fill-anim ${isActive ? 'active' : ''}" 
                            onclick="route('${path}')">${s}</div>`;
                }).join('');
                centerNav(subNav);
            } else {
                subContainer.classList.remove('visible');
                subNav.innerHTML = '';
            }

            // 3. Tertiary Nav (Children of activeTop/activeSub)
            const tertContainer = document.getElementById('h-tert');
            const tertNav = document.getElementById('tert-nav-container');
            
            if (activeSub) {
                const prefix = `${activeTop}/${activeSub}/`;
                const validTerts = [...new Set(db
                    .filter(r => r.Page && r.Page.startsWith(prefix))
                    .map(r => r.Page.split('/')[2])
                    .filter(x => x)
                )].sort();

                if (validTerts.length > 0) {
                    tertContainer.classList.add('visible');
                    tertNav.innerHTML = validTerts.map(t => {
                        const isActive = (t === activeTert);
                        const path = `${prefix}${t}`;
                        return `<div class="tert-link fill-anim ${isActive ? 'active' : ''}" 
                                onclick="route('${path}')">${t}</div>`;
                    }).join('');
                    centerNav(tertNav);
                } else {
                    tertContainer.classList.remove('visible');
                    tertNav.innerHTML = '';
                }
            } else {
                tertContainer.classList.remove('visible');
                tertNav.innerHTML = '';
            }
        }

        function centerNav(el) {
            // Simple centering logic
            const active = el.querySelector('.active');
            if (active) {
                const centerVal = active.offsetLeft + (active.clientWidth / 2) - (el.clientWidth / 2);
                el.scrollTo({ left: centerVal, behavior: 'smooth' });
            }
        }

        /* --- PAGE RENDERING --- */

        function renderHome() {
            const app = document.getElementById('app'); app.innerHTML = '';

            // 1. Featured Section
            const featured = db.filter(r => r.Tags && r.Tags.toLowerCase().includes('featured') && r.Page !== 'Home');
            if(featured.length > 0) {
                app.innerHTML += `<div class="section"><h2 style="text-align:center; font-weight:300; margin-bottom:20px; color:#fff;">FEATURED</h2></div>`;
                renderGrid(featured, app);
            }

            // 2. Recent Activity (Excluding featured to prevent dupe? Or show all?)
            // Let's show Recents that ARENT featured to keep it clean.
            const recents = db.filter(r => r.Page !== 'Home' && r.Page !== 'Footer' && (!r.Tags || !r.Tags.toLowerCase().includes('featured')))
                              .sort((a,b) => new Date(b.Timestamp || 0) - new Date(a.Timestamp || 0))
                              .slice(0, 8);
            
            if (recents.length > 0) {
                app.innerHTML += `<div class="section"><h2 style="text-align:center; font-weight:300; margin:40px 0 20px; color:#888; font-size:16px; letter-spacing:2px;">RECENT UPDATES</h2></div>`;
                renderGrid(recents, app);
            }
        }

        function renderTimeline() {
            const app = document.getElementById('app'); app.innerHTML = '';
            app.innerHTML = `<div class="section layout-hero"><h1 class="fill-anim">TIMELINE</h1></div>`;

            const container = document.createElement('div');
            container.className = 'timeline-container section';

            // Group by Month YYYY
            const groups = {};
            const validItems = db.filter(r => r.Timestamp && r.Page !== 'Footer').sort((a,b) => new Date(b.Timestamp) - new Date(a.Timestamp));

            validItems.forEach(item => {
                const d = new Date(item.Timestamp);
                const key = `${d.toLocaleString('default', { month: 'long' })} ${d.getFullYear()}`;
                if (!groups[key]) groups[key] = [];
                groups[key].push(item);
            });

            // Iterate groups
            Object.keys(groups).forEach(dateKey => {
                const items = groups[dateKey].sort((a, b) => a.Title.localeCompare(b.Title)); // A-Z inside month
                
                const groupDiv = document.createElement('div');
                groupDiv.className = 'timeline-group';

                const dateCol = document.createElement('div');
                dateCol.className = 'timeline-date';
                dateCol.innerText = dateKey;

                const cardsCol = document.createElement('div');
                cardsCol.className = 'timeline-cards';

                // Render miniature cards
                items.forEach(r => {
                    const card = createCard(r);
                    cardsCol.appendChild(card);
                });

                groupDiv.appendChild(dateCol);
                groupDiv.appendChild(cardsCol);
                container.appendChild(groupDiv);
            });

            app.appendChild(container);
        }

        function renderIndex() {
            const app = document.getElementById('app'); app.innerHTML = '';
            app.innerHTML = `<div class="section layout-hero"><h1 class="fill-anim">INDEX</h1></div>`;

            const list = document.createElement('div'); list.className = 'index-list section';
            
            // Get all unique pages, sort Alphabetically
            const allPages = [...new Set(db.map(r => r.Page).filter(p => p && p !== 'Home' && p !== 'Footer'))].sort();

            const groups = {};
            allPages.forEach(p => {
                const root = p.split('/')[0];
                if (!groups[root]) groups[root] = [];
                groups[root].push(p);
            });

            // Render
            Object.keys(groups).sort().forEach(cat => {
                let html = `<div class="index-group cat-${cat.toLowerCase()}"><h3>${cat}</h3>`;
                
                groups[cat].forEach(pagePath => {
                    const parts = pagePath.split('/');
                    const depth = parts.length;
                    const title = parts[parts.length - 1]; // Just the last part name
                    
                    // Add class for hierarchy indent
                    const indentClass = depth > 2 ? 'level-2' : '';
                    
                    html += `<a href="#${pagePath}" class="index-link fill-anim ${indentClass}">${title}</a>`;
                });
                
                html += `</div>`;
                list.innerHTML += html;
            });

            app.appendChild(list);
        }

        function renderPage(path, topLevel) {
            const app = document.getElementById('app'); app.innerHTML = '';
            
            // 1. Direct Matches
            const rows = db.filter(r => r.Page === path).sort((a,b) => new Date(b.Timestamp) - new Date(a.Timestamp));
            
            if (rows.length > 0) {
                renderGrid(rows, app);
            }

            // 2. Children Overviews (if this is a parent page)
            const children = [...new Set(db.filter(r => r.Page && r.Page.startsWith(path + '/')).map(r => r.Page))];
            if (children.length > 0 && rows.length === 0) {
                 // Create overview cards for children
                 // Pick the latest item from each child as the thumbnail?
                 // Or just create a generic link card?
                 // Let's just find "Featured" or "Latest" items from children to show.
                 const childItems = children.map(c => {
                     const items = db.filter(r => r.Page === c);
                     // return the one with media if possible, else first
                     return items.find(x => x.Media) || items[0];
                 }).filter(x => x);
                 
                 renderGrid(childItems, app);
            }

            if (rows.length === 0 && children.length === 0) {
                 app.innerHTML = `<div style="text-align:center; padding:50px;"><h2>Empty Repository</h2><p>No data found for ${path}</p></div>`;
            }
        }

        /* --- UI COMPONENTS --- */

        function renderGrid(rows, container) {
            const grid = document.createElement('div');
            grid.className = 'grid-container section';
            rows.forEach(r => grid.appendChild(createCard(r)));
            container.appendChild(grid);
        }

        function createCard(r) {
            const d = document.createElement('div');
            
            // Determine category color class
            let catClass = '';
            if (r.Page.startsWith('Projects')) catClass = 'cat-projects';
            else if (r.Page.startsWith('Professional')) catClass = 'cat-professional';
            else if (r.Page.startsWith('Personal')) catClass = 'cat-personal';

            d.className = `layout-grid clickable-block ${catClass}`;
            d.onclick = () => {
                if(r.LinkURL && !r.LinkURL.startsWith('#')) window.open(r.LinkURL, '_blank');
                else if(r.LinkURL) route(r.LinkURL.substring(1));
                else route(r.Page);
            };

            // Media
            let mediaHtml = `<div class="row-media placeholder"><span>${r.Title}</span></div>`;
            if (r.Media) {
                let src = r.Media;
                // Youtube Thumb Logic
                if(src.includes('youtube') || src.includes('youtu.be')) {
                    const id = src.split('v=')[1]?.split('&')[0] || src.split('/').pop();
                    src = `https://img.youtube.com/vi/${id}/mqdefault.jpg`;
                }
                mediaHtml = `<div class="row-media"><img src="${src}" loading="lazy"></div>`;
            }

            // Tags/Date
            let metaHtml = '';
            if (r.Timestamp) {
                const dateVal = formatDate(r.Timestamp);
                metaHtml += `<span class="chip date">${dateVal}</span>`;
            }

            d.innerHTML = `${mediaHtml}
                           <h3 class="fill-anim">${r.Title}</h3>
                           <p>${r.Content ? r.Content.substring(0, 100) + '...' : ''}</p>
                           <div class="meta-row">${metaHtml}</div>`;
            return d;
        }

        /* --- FOOTER & SCROLL --- */

        function renderFooter() {
            const div = document.getElementById('footer-links');
            // Static links + Timeline
            div.innerHTML = `
                <a href="#Timeline" class="fill-anim" onclick="route('Timeline')">Timeline</a>
                <a href="#Index" class="fill-anim" onclick="route('Index')">Index</a>
                <a href="mailto:sahibdsv+site@gmail.com" class="fill-anim">Contact</a>
                <a href="https://linkedin.com/in/sahibvirdee" target="_blank" class="fill-anim">LinkedIn</a>
            `;
            document.getElementById('version-tag').innerText = "Last Updated: " + new Date().toLocaleDateString();
        }

        /* Scroll Logic for Header Collapse */
        let lastScroll = 0;
        window.addEventListener('scroll', () => {
            const current = window.pageYOffset;
            const body = document.body;
            
            if (current <= 0) {
                body.classList.remove('header-collapsed');
                return;
            }
            
            if (current > lastScroll && current > 100) {
                // Scroll Down
                body.classList.add('header-collapsed');
            } else {
                // Scroll Up
                body.classList.remove('header-collapsed');
            }
            lastScroll = current;
        });

        /* --- UTILITIES --- */
        function toggleSearch(show) {
            const overlay = document.getElementById('search-overlay');
            if(show) {
                overlay.classList.add('active');
                setTimeout(() => document.getElementById('search-input').focus(), 100);
            } else {
                overlay.classList.remove('active');
            }
        }

        function handleSearch(q) {
            if(!q) return;
            const res = db.filter(r => r.Title.toLowerCase().includes(q.toLowerCase()));
            const app = document.getElementById('app'); app.innerHTML = '';
            app.innerHTML = `<div class="section"><h2>SEARCH: ${q}</h2></div>`;
            renderGrid(res, app);
        }

        function formatDate(s) {
            if(!s) return '';
            const d = new Date(s);
            return isNaN(d) ? s : `${d.toLocaleString('default',{month:'short'}).toUpperCase()} ${d.getFullYear()}`;
        }

        function setupInteractions() {
            // Horizontal scroll fade logic
            document.querySelectorAll('.timeline-cards').forEach(el => {
                el.addEventListener('scroll', (e) => {
                    // Adjust mask based on scroll position if needed
                    // CSS mask takes care of static fade, dynamic would require JS
                });
            });
        }

        init();
    </script>
</body>
</html>