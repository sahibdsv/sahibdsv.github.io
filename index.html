<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sahib Virdee</title>
    <link rel="stylesheet" href="/projects/sahibdsv/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>

    <header id="main-header">
        <div id="brand-name">Sahib Virdee</div>
        <nav id="dynamic-nav">
            </nav>
    </header>

    <div class="content-container" id="app">
        <p style="text-align:center; padding-top: 50px; color: #444;">Loading...</p>
    </div>

    <script>
        // --- CONFIGURATION ---
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT7HtdJsNwYO8TkB4mem_IKZ-D8xNZ9DTAi-jgxpDM2HScpp9Tlz5DGFuBPd9TuMRwP16vUd-5h47Yz/pub?output=csv";
        // ---------------------

        let db = []; // Will hold the sheet data

        // 1. Fetch Data
        Papa.parse(SHEET_URL, {
            download: true,
            header: true,
            complete: function(results) {
                db = results.data;
                initApp();
            }
        });

        // 2. Initialize
        function initApp() {
            buildNav();
            
            // Get current page from URL (?page=X) or default to 'Home'
            const params = new URLSearchParams(window.location.search);
            const currentPage = params.get('page') || 'Home';
            
            renderPage(currentPage);
        }

        // 3. Build Navigation (Smart)
        function buildNav() {
            // Find all unique values in "Page" column
            const pages = [...new Set(db.map(row => row.Page).filter(p => p))];
            
            const nav = document.getElementById('dynamic-nav');
            nav.innerHTML = '';

            pages.forEach(pageName => {
                // If pageName contains a slash (Personal/Family), it's a subpage.
                // For simplicity, we only show Top Level items in main nav
                const topLevel = pageName.split('/')[0];
                
                // Avoid duplicates in Nav
                if (!nav.innerHTML.includes(`?page=${topLevel}`)) {
                    const link = document.createElement('a');
                    link.innerText = topLevel;
                    link.href = `?page=${topLevel}`;
                    
                    // Highlight active
                    const params = new URLSearchParams(window.location.search);
                    const current = params.get('page') || 'Home';
                    if (current.startsWith(topLevel)) link.classList.add('active');

                    nav.appendChild(link);
                }
            });
        }

        // 4. Render the Content
        function renderPage(pageName) {
            const app = document.getElementById('app');
            app.innerHTML = '';

            // Filter rows that match the requested page
            // Logic: If I ask for "Personal", show "Personal" AND "Personal/Family"?
            // User requested: "Personal - Family should be a subpage".
            // Implementation: We show everything starting with that path.
            
            const rows = db.filter(row => row.Page && row.Page.startsWith(pageName));

            if (rows.length === 0) {
                app.innerHTML = '<p style="text-align:center; margin-top:50px;">Page not found (or empty).</p>';
                return;
            }

            // Loop through rows and build HTML based on "SectionType"
            rows.forEach(row => {
                const section = document.createElement('div');
                section.className = `section layout-${row.SectionType}`;

                let html = '';

                // --- TEMPLATE LOGIC ---
                if (row.SectionType === 'hero') {
                    html = `<h1>${row.Title}</h1><p>${row.Content}</p>`;
                } 
                else if (row.SectionType === 'text') {
                    if (row.Title) html += `<h2>${row.Title}</h2>`;
                    html += `<p>${row.Content}</p>`;
                }
                else if (row.SectionType === 'card') {
                    html = `
                        ${row.Media ? `<img src="${row.Media}">` : ''}
                        <div>
                            <h3>${row.Title}</h3>
                            <p>${row.Content}</p>
                            ${row.Timestamp ? `<div class="timestamp">Updated: ${row.Timestamp}</div>` : ''}
                        </div>
                    `;
                }
                else if (row.SectionType === 'image') {
                     html = `<img src="${row.Media}" style="width:100%; border-radius:8px;">
                             ${row.Content ? `<p style="text-align:center; font-size:14px; margin-top:5px; color:#666;">${row.Content}</p>` : ''}`;
                }
                // ----------------------

                section.innerHTML = html;
                app.appendChild(section);
            });
        }

        // 5. Shrink Header on Scroll
        window.addEventListener('scroll', () => {
            const header = document.getElementById('main-header');
            if (window.scrollY > 50) header.classList.add('shrink');
            else header.classList.remove('shrink');
        });
    </script>

</body>
</html>